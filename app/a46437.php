<?php
session_start(); require_once 'includes/c04l340f.php'; require_once INC . '/f08034r.php'; include_once INC . "/cy04l340f.php"; $spccc977 = ''; $sp263229 = array(); if ($_SESSION['admin'] != 1) { header('location: login.php'); exit; } $spef97ed = new C0as8f2(); $spb7a591 = null; $spc1bf8a = null; $spe1a90d = false; if (isset($_POST['companyName'])) { $spc1bf8a = $_POST['companyName']; } if (isset($_POST['op'])) { if ($_POST['op'] == 'add' || $_POST['op'] == 'delete') { if (isset($_POST['companyID'])) { $spccc977 = $_POST['companyID']; } else { echo "No company selected, retry"; exit; } } elseif ($_POST['op'] == 'info') { $spef97ed->setC0as8f2($_POST['id']); $sp7b6a39 = $spef97ed->getC0as8f2Info(); header('Content-type: application/json'); echo json_encode($sp7b6a39); exit; } if ($_POST['op'] == 'add') { if (!$_POST['userName'] || !$_POST['password']) { echo "Missing user ID or password. Try again."; exit; } if (isset($_POST['companyNew'])){$companyName=$_POST['companyName'] = $_POST['companyNew'];$mySelect=$_POST['companyID'] = $_POST['company_id'];}$spef97ed->setC0as8f2($spccc977); $spef97ed->updC080dsj($_POST); } elseif ($_POST['op'] == 'delete') { $spf2272f = $sp563fcc->prepare("UPDATE Companies SET userName='', password='', invUrl='', statusUrl='' WHERE companyID=?"); $sp2669f6 = $spf2272f->execute(array($_POST['companyID'])); if (!$sp2669f6) { echo "Company selected is not in the database. Try again or contact developer."; exit; } } elseif ($_POST['op'] == 'update') { ignore_user_abort(true); set_time_limit(0); $sp8a5815 = file_get_contents('https://s3.us-east-2.amazonaws.com/psutil/companies/companies.json'); $sp0278a1 = json_decode($sp8a5815); foreach ($sp0278a1 as $sp263a81 => $spf6c0f8) { $sp346a7d = array('companyID', 'companyName', 'invUrl', 'invEndPt', 'invVersion', 'statusUrl', 'statusEndPt', 'statusVersion', 'productUrl', 'productEndPt', 'productVersion', 'shippingUrl', 'shippingVersion', 'shippingEndPt', 'mediaUrl', 'mediaVersion', 'mediaEndP'); foreach ($spf6c0f8 as $sp168b76 => $sp6b47c3) { $spb987f0["{$sp168b76}"] = $sp6b47c3; } $sp610278 = array('companyID' => $spf6c0f8->companyID); $spf2272f = $spae6e20->PDO_replace('Companies', $sp346a7d, $spb987f0, $sp610278); } exit('done'); } } $sp2c9bfa = $spef97ed->getAllCompanies(); $sp99e24b = $spef97ed->getAvailableInvRequestCompaniesCSS(); $sp6f2f8e = 'Inventory Request'; require_once INC . '/ira080sdm.php'; exit; function add_domain($sp4b82a8, $spf0c143) { if (substr($sp4b82a8, 0, 4) !== "wsdl") { return $sp4b82a8; } $sp723d73 = parse_url($spf0c143); if ($sp723d73) { $spcaebef = $sp723d73['scheme'] . '://' . $sp723d73['host'] . '/'; return str_replace('wsdl/', $spcaebef, $sp4b82a8); } } function check_url($sp898c72, $spae54b0) { if (isset($sp898c72->Service->WSDL) && isset($sp898c72->URL)) { if (substr($sp898c72->Service->WSDL, 0, 4) == 'wsdl' and substr($sp898c72->URL, -3) == 'srv') { update_value($spae54b0 . 'Url', add_domain($sp898c72->Service->WSDL, $sp898c72->URL)); update_value($spae54b0 . 'EndPt', $sp898c72->URL); } else { $sp898c72->Service->WSDL = add_domain($sp898c72->Service->WSDL, $sp898c72->URL); update_value($spae54b0 . 'EndPt', $sp898c72->Service->WSDL); } } } function update_value($sp263a81, $sp93d81f) { global $sp536b1d, $sp5b3d50, $spae6428, $spef97ed; if ($sp536b1d && !$sp536b1d[$sp263a81]) { $spef97ed->change_log($sp263a81, $sp93d81f, $sp536b1d[$sp263a81], 'utility'); $spae6428 = true; $sp5b3d50[$sp263a81] = $sp93d81f; } elseif (!$sp536b1d) { $sp5b3d50[$sp263a81] = $sp93d81f; } } function updatecompanies($spef97ed) { global $sp563fcc, $spae6e20; global $sp536b1d, $sp5b3d50, $spae6428, $spef97ed; $sp230854 = 0; $sp44cf7a = file_get_contents('/var/www/html/includes/companies.json'); if (!$sp44cf7a) { exit("Promo Standards all companies url is not available at this time"); } $sp3e8166 = json_decode($sp44cf7a); $sp14c0c7 = array(); $sp7eb79b = array(); foreach ($sp3e8166 as $sp0278a1) { $sp230854++; $sp536b1d = null; $spae6428 = false; if ($spef97ed->setC0as8f2($sp0278a1->Code)) { $sp536b1d = $spef97ed->getC0as8f2Info(); $sp5b3d50 = $sp536b1d; } else { error_log($sp0278a1->Name); $sp5b3d50 = array("companyName" => $sp0278a1->Name, "companyID" => $sp0278a1->Code); } $sp44cf7a = file_get_contents($spef97ed->companyEndpointsUrl . $sp0278a1->Code . "/endpoints"); if ($sp44cf7a && $sp44cf7a != '[]') { $spe7e18b = json_decode($sp44cf7a); foreach ($spe7e18b as $sp898c72) { if (isset($sp898c72->Service->ServiceType->Code) && $sp898c72->Service->ServiceType->Code == 'INV') { if (isset($sp898c72->Service->Version)) { update_value('invVersion', $sp898c72->Service->Version); } if (isset($sp898c72->URL)) { update_value('invUrl', $sp898c72->URL); } check_url($sp898c72, 'inv'); } elseif (isset($sp898c72->Service->ServiceType->Code) && $sp898c72->Service->ServiceType->Code == 'ODRSTAT') { if (isset($sp898c72->Service->Version)) { update_value('statusVersion', $sp898c72->Service->Version); } if (isset($sp898c72->URL)) { update_value('statusUrl', $sp898c72->URL); } check_url($sp898c72, 'status'); } elseif (isset($sp898c72->Service->ServiceType->Code) && $sp898c72->Service->ServiceType->Code == 'OSN') { if (isset($sp898c72->Service->Version)) { update_value('shippingVersion', $sp898c72->Service->Version); } if (isset($sp898c72->URL)) { update_value('shippingUrl', $sp898c72->URL); } check_url($sp898c72, 'shipping'); } elseif (isset($sp898c72->Service->ServiceType->Code) && $sp898c72->Service->ServiceType->Code == 'MED') { if (isset($sp898c72->Service->Version)) { update_value('mediaVersion', $sp898c72->Service->Version); } if (isset($sp898c72->URL)) { update_value('mediaUrl', $sp898c72->URL); } check_url($sp898c72, 'media'); } elseif (isset($sp898c72->Service->ServiceType->Code) && $sp898c72->Service->ServiceType->Code == 'Product') { if (isset($sp898c72->Service->Version)) { update_value('productVersion', $sp898c72->Service->Version); } if (isset($sp898c72->URL)) { update_value('productUrl', $sp898c72->URL); } check_url($sp898c72, 'product'); } } $sp346a7d = array("companyName", "companyID", "invUrl", "mediaUrl", "productUrl", "statusUrl", "shippingUrl", "invVersion", "mediaVersion", "productVersion", "statusVersion", "shippingVersion", "invEndPt", "mediaEndPt", "productEndPt", "statusEndPt", "shippingEndPt"); if ($spae6428) { exit('1'); $spb987f0 = array(); foreach ($sp5b3d50 as $sp168b76 => $sp6b47c3) { if (!empty(trim($sp6b47c3))) { $spb987f0[$sp168b76] = $sp6b47c3; } } $sp610278 = array('row_id' => $sp536b1d['row_id']); if (sizeof($spb987f0) > 1) { $spf2272f = $spae6e20->PDO_update('Companies', $sp346a7d, $spb987f0, $sp610278); } } elseif (!$sp536b1d) { foreach ($sp5b3d50 as $sp168b76 => $sp6b47c3) { if (!empty(trim($sp6b47c3))) { $spb987f0[$sp168b76] = $sp6b47c3; } } foreach ($sp346a7d as $sp168b76 => $sp6b47c3) { if (!$spb987f0[$sp6b47c3]) { $spb987f0[$sp6b47c3] = '0'; } } $spf2272f = $spae6e20->PDO_insert('Companies', $sp346a7d, $spb987f0); } } error_log("Number of companies processed:{$sp230854}"); } }
